---
title: "Monte Carlo Simulation Tools for REDD+ Uncertainty Estimates"
date: 2024-12-19
output: 
  pdf_document: 
    highlight: pygments
    toc: true
    toc_depth: 3
    latex_engine: xelatex

      
bibliography: references.bib
csl: american-chemical-society.csl
always_allow_html: true
df-print: kable      
editor_options: 
  markdown: 
    wrap: 80
---

```{r setup-1}
#| warning: false
#| message: false
#| error: false
#| include: false
#| echo: false
easypackages::packages(
  "animation", "allodb", "BIOMASS", "c2z", "caret", "dataMaid", "DescTools","dplyr",
  "extrafont", "FawR", "ForestToolsRS", "formatR", "ggplot2", "htmltools",
  "janitor", "jsonlite", "lattice", "kableExtra", "kernlab",
  "knitr", "Mlmetrics", "olsrr", "plotly", "psych", "RColorBrewer",
  "rmarkdown", "readxl", "tibble", "tidymodels", "tidyverse",
  "tinytex", "tune", "useful", "webshot", "webshot2", 
  prompt = F
  )
  
knitr::opts_chunk$set(
  echo    = TRUE, 
  message = FALSE, 
  warning = FALSE,
  error   = FALSE, 
  cache   = FALSE,
  comment = NA, 
  tidy.opts = list(width.cutoff = 60)
)

options(htmltools.dir.version = FALSE, htmltools.preserve.raw = FALSE)
knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 80), tidy = TRUE)
```

```{css, echo=FALSE, class.source = 'foldable'}
div.column {
    display: inline-block;
    vertical-align: top;
    width: 50%;
}

#TOC::before {
  content: "";
  display: block;
  height: 80px;
  width: 210px;
  background-image: url(https://winrock.org/wp-content/uploads/2021/12/Winrock-logo-R.png);
  background-size: contain;
  background-position: center;
  background-position: 50% 50%;
  padding-top: 80px !important;
  background-repeat: no-repeat;
}
```

## Import data

```{r}
workbook  = "./data/testdata/GuyanaARTWorkbookMC_thru2022_April2024_copy.xlsx"
worksheet = readxl::read_excel(workbook, "CarbonStocks")
head(worksheet)
```

## Replicate SimVoi

We utilize the replicate function to execute the simulation multiple times with `replicate(n=10000`, while determining the size of the sampled subset with `rnorm(n=100`. The first model explores sample size parameters only, replication parameters are tested below this in comparisons.

```{r}
MEAN = worksheet$`AG Tree (tC/ha)`[1]
SD   = worksheet$`AG Tree (tC/ha)`[2]

randtruncnormal_sim_10000 <- rnorm(n=10000,mean=MEAN,sd=SD)
plot(randtruncnormal_sim_10000)
hist(randtruncnormal_sim_10000)
hist(randtruncnormal_sim_10000, freq=F)
curve(dnorm(x, mean=MEAN, sd=SD), from=150, to=250, add=T, col="red")
```

## Compare simulations

```{r, fig.show='hold', out.width='50%'}
# 10,000 simulations sampling 10 observations
randtruncnormal_sim_10000_10 = replicate(
  n=10000, rnorm(n=10, mean=MEAN,sd=SD))
hist(apply(X = randtruncnormal_sim_10000_10, MARGIN=2, FUN=mean))
hist(apply(X = randtruncnormal_sim_10000_10, MARGIN=2, FUN=sd))
sd(apply(X = randtruncnormal_sim_10000_10, MARGIN=2, FUN=mean))

# 10,000 simulations sampling 100 observations
randtruncnormal_sim_10000_100 = replicate(
  n=10000,rnorm(n=100, mean=MEAN,sd=SD))
hist(apply(X = randtruncnormal_sim_10000_100, MARGIN=2, FUN=mean))
hist(apply(X = randtruncnormal_sim_10000_100, MARGIN=2, FUN=sd))
sd(apply(X = randtruncnormal_sim_10000_100, MARGIN=2, FUN=mean))

# 10,000 simulations sampling 1,000 observations
randtruncnormal_sim_10000_1000 = replicate(
  n=10000, rnorm(n=1000, mean=MEAN, sd=SD))
hist(apply(X = randtruncnormal_sim_10000_1000, MARGIN=2, FUN=mean))
hist(apply(X = randtruncnormal_sim_10000_1000, MARGIN=2, FUN=sd))
sd(apply(X = randtruncnormal_sim_10000_1000, MARGIN=2, FUN=mean))

# 10,000 simulations sampling 10,000 observations
randtruncnormal_sim_10000_10000 = replicate(
  n=10000, rnorm(n=10000, mean=MEAN, sd=SD))
hist(apply(X = randtruncnormal_sim_10000_10000, MARGIN=2, FUN=mean))
hist(apply(X = randtruncnormal_sim_10000_10000, MARGIN=2, FUN=sd))
sd(apply(X = randtruncnormal_sim_10000_10000, MARGIN=2, FUN=mean))

```


```{r}
#| eval: true
devtools::session_info()
#Sys.getenv()
#.libPaths()
```

## References
